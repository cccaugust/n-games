<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>ドット絵メーカー | N-Games</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="../../style.css" />
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="topbar-inner">
        <div class="brand">
          <div class="brand-title">ドット絵メーカー</div>
          <div class="brand-sub">つくる → ためる → ゲームでつかう（準備中）</div>
        </div>

        <div class="topbar-actions">
          <div class="player-pill" id="playerPill">Player</div>
          <a class="btn-link" id="backToPortal" href="#">ポータルへ</a>
        </div>
      </div>
    </header>

    <main class="container app" id="appRoot" data-view="gallery">
      <section class="card gallery" id="galleryView">
        <div class="gallery-head">
          <div>
            <div class="section-title">ギャラリー</div>
            <div class="tiny-note">作品をえらんで編集 / もしくは新規作成</div>
          </div>
          <div class="gallery-head-actions">
            <button class="btn-sub" id="gallerySamplesBtn" type="button">サンプル</button>
            <button class="btn-primary-solid" id="galleryNewBtn" type="button">＋ 新規作成</button>
          </div>
        </div>
        <div class="gallery-controls" aria-label="ギャラリー操作">
          <div class="gallery-search">
            <label class="sr-only" for="gallerySearchInput">検索</label>
            <input id="gallerySearchInput" type="search" inputmode="search" placeholder="なまえで検索…" />

            <label class="sr-only" for="gallerySortSelect">並び替え</label>
            <select id="gallerySortSelect">
              <option value="updated_desc">新しい順</option>
              <option value="updated_asc">古い順</option>
              <option value="name_asc">名前（A→Z）</option>
              <option value="name_desc">名前（Z→A）</option>
              <option value="size_desc">サイズ（大きい順）</option>
              <option value="size_asc">サイズ（小さい順）</option>
            </select>
          </div>
        </div>
        <div class="gallery-summary" id="gallerySummary" aria-live="polite"></div>
        <div class="gallery-grid" id="galleryList"></div>
      </section>

      <div class="workspace" id="editorView" hidden>
        <header class="editor-headbar card" id="editorHeadbar" aria-label="エディターヘッダー">
          <div class="editor-headbar-left">
            <button class="btn-sub" id="backToGalleryBtn" type="button" aria-label="ギャラリーに戻る">
              <i class="fa-solid fa-arrow-left" aria-hidden="true"></i>
              <span class="btn-text">ギャラリー</span>
            </button>
          </div>

          <div class="editor-headbar-center">
            <input id="nameInput" type="text" maxlength="40" placeholder="なまえをつけよう" class="editor-name-input" aria-label="名前を変える" />
          </div>

          <div class="editor-headbar-right">
            <div class="editor-headbar-actions">
              <button class="btn-sub btn-icon" id="undoBtn" type="button" aria-label="もどす" title="もどす">
                <i class="fa-solid fa-rotate-left" aria-hidden="true"></i>
              </button>
              <button class="btn-sub btn-icon" id="redoBtn" type="button" aria-label="やりなおし" title="やり直">
                <i class="fa-solid fa-rotate-right" aria-hidden="true"></i>
              </button>
            </div>
            <button class="btn-primary-solid" id="saveBtn" type="button" aria-label="保存">
              <i class="fa-solid fa-floppy-disk" aria-hidden="true"></i>
              <span class="btn-text">保存</span>
            </button>
          </div>
        </header>

        <div class="editor-layout">
          <aside class="editor-left" aria-label="ツールボックス">
            <div class="editor-toolbar card" id="editorToolbar" aria-label="編集ツール">
              <div class="toolbar-row toolbar-primary" aria-label="よく使う">
                <div class="toolbar-group" aria-label="ツール">
                  <button class="tool-icon active" id="toolPen" type="button" aria-label="書く（ペン）" title="書く（ペン）">
                    <i class="fa-solid fa-pen"></i><span>書く</span>
                  </button>
                  <button class="tool-icon" id="toolEraser" type="button" aria-label="消しゴム">
                    <i class="fa-solid fa-eraser"></i><span>消し</span>
                  </button>
                  <button class="tool-icon" id="toolFill" type="button" aria-label="ベタ塗り">
                    <i class="fa-solid fa-fill-drip"></i><span>塗り</span>
                  </button>
                  <button class="tool-icon" id="toolSelect" type="button" aria-label="範囲選択">
                    <i class="fa-regular fa-object-group"></i><span>範囲</span>
                  </button>
                </div>

                <div class="toolbar-group" aria-label="色">
                  <div class="toolbar-palette" id="toolbarPalette" aria-label="色パレット（64色）"></div>

                  <div class="pm-color-actions" aria-label="色の操作">
                    <button class="tool-icon" id="pickColorBtn" type="button" aria-label="スポイト（画面から色を取る）" title="スポイト">
                      <i class="fa-solid fa-eye-dropper" aria-hidden="true"></i>
                      <span>スポイト</span>
                    </button>

                    <button class="tool-icon" id="colorBtn" type="button" aria-label="フルカラー" title="フルカラー">
                      <i class="fa-solid fa-palette" aria-hidden="true"></i>
                      <span>フルカラー</span>
                    </button>

                    <!-- フルカラー（ネイティブカラーピッカー）。ボタン押下で直接開く -->
                    <input id="colorInput" class="pm-fullcolor-input" type="color" value="#333333" aria-label="フルカラー（色をえらぶ）" />
                  </div>

                  <!-- 既存のキャンバススポイト（ショートカット/内部状態用） -->
                  <button class="sr-only" id="toolPicker" type="button" aria-label="スポイト（キャンバス）"></button>
                </div>


                <div class="toolbar-group" aria-label="範囲操作">
                  <button class="tool-icon" id="rangeCopyBtn" type="button" aria-label="コピー（範囲選択）">
                    <i class="fa-regular fa-copy"></i><span>コピー</span>
                  </button>
                  <button class="tool-icon" id="rangeCutBtn" type="button" aria-label="切り取り（範囲選択）">
                    <i class="fa-solid fa-scissors"></i><span>切取</span>
                  </button>
                  <button class="tool-icon" id="rangePasteBtn" type="button" aria-label="ペースト（範囲選択）">
                    <i class="fa-regular fa-clipboard"></i><span>貼付</span>
                  </button>
                </div>

                <div class="toolbar-group" aria-label="メニュー">
                  <button class="tool-icon" id="toolbarMenuBtn" type="button" aria-label="メニューを開く" aria-expanded="false">
                    <i class="fa-solid fa-ellipsis"></i><span>メニュー</span>
                  </button>
                </div>
              </div>

              <div class="toolbar-row toolbar-more" id="toolbarMore" aria-label="その他" hidden>
                <div class="toolbar-group" aria-label="色相">
                  <button class="tool-icon" id="hueBtn" type="button" aria-label="色相を変える（プレビュー）">
                    <i class="fa-solid fa-circle-half-stroke"></i><span>色相</span>
                  </button>

                  <div class="hue-popover card" id="huePopover" hidden>
                    <div class="color-popover-head">
                      <div class="color-popover-title">色相</div>
                      <button class="btn-sub btn-icon" id="huePopoverCloseBtn" type="button" aria-label="閉じる">
                        <i class="fa-solid fa-xmark"></i>
                      </button>
                    </div>

                    <div class="hue-row">
                      <div class="hue-label">
                        <span>プレビュー</span>
                        <strong id="hueValue">0°</strong>
                      </div>
                      <input id="hueRange" type="range" min="-180" max="180" step="1" value="0" aria-label="色相" />
                      <div class="hue-actions">
                        <button class="btn-mini" id="hueResetBtn" type="button">リセット</button>
                        <button class="btn-mini primary" id="hueApplyBtn" type="button">適用</button>
                      </div>
                      <div class="tiny-note">※「適用」で色を確定（もどすOK）</div>
                    </div>
                  </div>
                </div>

                <div class="toolbar-group" aria-label="操作">
                  <button class="tool-icon" id="clearBtn" type="button" aria-label="全消し">
                    <i class="fa-solid fa-trash-can"></i><span>全消</span>
                  </button>
                  <button class="tool-icon" id="importImageBtn" type="button" aria-label="画像を読み込む">
                    <i class="fa-solid fa-image"></i><span>画像</span>
                  </button>
                  <input class="sr-only" id="importImageInput" type="file" accept="image/*" />
                  <button class="tool-icon" id="exportBtn" type="button" aria-label="PNGを書き出す">
                    <i class="fa-solid fa-file-arrow-down"></i><span>PNG</span>
                  </button>
                </div>

                <div class="toolbar-group" aria-label="フレーム">
                  <button class="tool-icon" id="framesBtn" type="button" aria-label="フレームを開く">
                    <i class="fa-solid fa-layer-group"></i><span>フレーム</span>
                  </button>
                </div>

                <div class="toolbar-group" aria-label="保存など">
                  <button class="tool-icon" id="newBtn" type="button" aria-label="新規">
                    <i class="fa-solid fa-file-circle-plus"></i><span>新規</span>
                  </button>
                  <button class="tool-icon" id="duplicateBtn" type="button" aria-label="複製">
                    <i class="fa-solid fa-clone"></i><span>複製</span>
                  </button>
                  <button class="tool-icon danger" id="deleteBtn" type="button" aria-label="削除">
                    <i class="fa-solid fa-circle-xmark"></i><span>削除</span>
                  </button>
                </div>
              </div>

            </div>
          </aside>

          <div
            class="pm-splitter"
            id="splitLeft"
            role="separator"
            aria-orientation="vertical"
            aria-label="ツールボックスとキャンバスの境目"
            tabindex="0"
          ></div>

          <section class="card canvas-panel editor-center">
          <div class="canvas-head">
            <div class="canvas-head-left">
              <div class="small-label">キャンバス</div>
              <div class="canvas-meta" id="canvasMeta">-</div>
            </div>

            <div class="canvas-head-right">
              <div class="canvas-head-actions" aria-label="キャンバス操作">
                <button class="btn-mini" id="expandWidthBtn" type="button" aria-label="横にひろげる（+16）">
                  <i class="fa-solid fa-arrows-left-right" aria-hidden="true"></i> 横+16
                </button>
                <button class="btn-mini" id="expandHeightBtn" type="button" aria-label="縦にひろげる（+16）">
                  <i class="fa-solid fa-arrows-up-down" aria-hidden="true"></i> 縦+16
                </button>
                <button class="btn-mini" id="shrinkWidthBtn" type="button" aria-label="横をちぢめる（-16）">
                  <i class="fa-solid fa-minus" aria-hidden="true"></i> 横-16
                </button>
                <button class="btn-mini" id="shrinkHeightBtn" type="button" aria-label="縦をちぢめる（-16）">
                  <i class="fa-solid fa-minus" aria-hidden="true"></i> 縦-16
                </button>
              </div>
            </div>
          </div>

          <div class="canvas-subhead canvas-subhead-actions" aria-label="表示">
            <button class="btn-mini" id="gridToggleBtn" type="button" aria-label="グリッドON/OFF">
              <i class="fa-solid fa-border-all" aria-hidden="true"></i> 線
            </button>
            <div class="zoom-mini" aria-label="ズーム">
              <button class="btn-mini" id="zoomOutBtn" type="button" aria-label="ズームアウト">
                <i class="fa-solid fa-magnifying-glass-minus" aria-hidden="true"></i>
              </button>
              <input id="zoomRange" type="range" min="8" max="48" step="1" value="24" aria-label="ズーム" />
              <button class="btn-mini" id="zoomInBtn" type="button" aria-label="ズームイン">
                <i class="fa-solid fa-magnifying-glass-plus" aria-hidden="true"></i>
              </button>
            </div>
            <input class="sr-only" id="gridToggle" type="checkbox" checked />
          </div>

          <div class="canvas-scroll" id="canvasScroll">
            <div class="canvas-frame grid" id="canvasFrame">
              <canvas id="pixelCanvas"></canvas>
            </div>
          </div>
        </section>

          <div
            class="pm-splitter"
            id="splitRight"
            role="separator"
            aria-orientation="vertical"
            aria-label="キャンバスとフレームの境目"
            tabindex="0"
          ></div>

          <aside class="editor-right" aria-label="フレーム">
            <section class="frame-side card">
              <div class="frame-panel" aria-label="フレーム">
                <div class="frame-panel-head">
                  <div class="frame-panel-title">
                    <span class="small-label">フレーム</span>
                    <strong class="frame-counter" id="frameCounter">1/1</strong>
                  </div>

                  <div class="frame-actions">
                    <button class="btn-mini" id="framePrevBtn" type="button" aria-label="前のフレーム">◀</button>
                    <button class="btn-mini" id="frameNextBtn" type="button" aria-label="次のフレーム">▶</button>
                    <button class="btn-mini primary" id="frameAddBtn" type="button" aria-label="フレームを追加">＋ 追加</button>
                    <button class="btn-mini" id="frameDuplicateBtn" type="button" aria-label="フレームを複製">複製</button>
                    <button class="btn-mini btn-mini-danger" id="frameDeleteBtn" type="button" aria-label="フレームを削除">削除</button>
                  </div>
                </div>

                <div class="frame-list" id="frameList" aria-label="フレーム一覧"></div>
                <div class="tiny-note" id="frameHint">※ フレームを切り替えてアニメ素材を作れます</div>
              </div>
            </section>
          </aside>
        </div>
      </div>

      <div class="modal-backdrop" id="newAssetModal" hidden>
        <div class="card modal">
          <div class="modal-head">
            <div>
              <div class="section-title">新規作成</div>
              <div class="tiny-note">最初は 16×16。あとから横/縦にひろげられるよ（最大256）</div>
            </div>
            <button class="btn-sub" id="newAssetCloseBtn" type="button">× 閉じる</button>
          </div>

          <div class="row">
            <label class="field">
              <span>なまえ</span>
              <input id="newNameInput" type="text" maxlength="40" placeholder="なまえをつけよう" />
            </label>
          </div>

          <div class="row actions">
            <button class="btn-primary-solid" id="newAssetCreateBtn" type="button">作成して編集</button>
          </div>
        </div>
      </div>

      <div class="modal-backdrop" id="sampleModal" hidden>
        <div class="card modal">
          <div class="modal-head">
            <div>
              <div class="section-title">サンプル素材</div>
              <div class="tiny-note">コピーして、自分の作品として編集・保存できます（サンプル自体はDBに保存されません）</div>
            </div>
            <button class="btn-sub" id="sampleCloseBtn" type="button">× 閉じる</button>
          </div>

          <div class="assets-list" id="sampleList" aria-label="サンプル一覧"></div>
        </div>
      </div>

      <div class="modal-backdrop" id="framesModal" hidden>
        <div class="card modal pm-frames-modal" role="dialog" aria-label="フレーム">
          <div class="modal-head">
            <div>
              <div class="section-title">フレーム</div>
              <div class="tiny-note">コマを切り替えてアニメ素材を作れます</div>
            </div>
            <button class="btn-sub" id="framesCloseBtn" type="button">× 閉じる</button>
          </div>
          <div id="framesModalBody"></div>
        </div>
      </div>
    </main>

    <script type="module" src="./script.js"></script>
  </body>
</html>

