# Game: brick-breaker

## 概要
ブロックをボールで壊していくブロックくずしです。  
ステージ選択・ブロック種類（かたい/ぶんれつ）・コンティニュー・ステージエディタ（保存/共有）に対応しています。

## 操作方法
- **PC**: ゲーム画面（キャンバス）上でマウスをドラッグ/移動してバーを動かす
- **タッチ**: ゲーム画面上を指でドラッグしてバーを動かす

## ルール / 仕様
- **目的**: ボールを落とさずにブロックを全部こわす（ステージクリア）
- **スコア**:
  - ふつうブロック: +10
  - やわらかブロック: +10（こわすが反射しない）
  - かたいブロック（HP3）: こわしたとき +35、当てたとき +2
  - ぶんれつブロック: +25（こわすと「合計5こ」に分裂）
  - かべブロック: +0（壊れない。ステージクリア判定からも除外）
- **LIFE**: 3（ボールが全部落ちると -1）
- **コンティニュー**:
  - LIFE が残っていれば、その状態（ブロック/スコア）から「つづける」ができます
  - LIFE が0でも「コンティニュー」で復活できます（CONTINUE回数が表示されます）
- **ステージクリア**: ブロックが全部なくなるとクリア。次のステージへ進むか、選択画面へ戻れます

## 画面 / UI
- **モード選択**: 「あそぶ / つくる」を選ぶ
- **ステージ選択**: ステージを選んでプレイへ（必要なら編集へ）
- **プレイ**: HUD（SCORE/LIFE/BALL/CONTINUE）、一時停止 / 最初から
- **ステージ編集**: ブロック種を選んでペイント配置、保存/読みこみ/ぜんぶ消す
- **ステージライブラリ（編集内）**: ロード / 削除 / 書き出し（JSON）/ インポート / ぜんぶエクスポート

## 実装メモ（設計）
- **エントリ**: `index.html`（モード選択）
- **ページ**:
  - `stage-select.html`: ステージ選択
  - `play.html`: プレイ（スマホでゲーム画面を最大化）
  - `editor.html`: ステージ編集（スマホでも編集領域を広く）
- **メインロジック**:
  - `shared.js`: ステージ保存/読み込み（Supabase + localStorage）
  - `play.js`: プレイ処理
  - `editor.js`: エディタ処理
- **主要な状態(state)**:
  - プレイ: `playingStageName`, `bricks`, `balls`, `score`, `lives`, `continueCount`
  - エディタ: `currentStage`, `currentTool`
- **データ保存（ステージ）**:
  - **Supabase**: `brick_breaker_stages` テーブル（`name` ユニーク / `data` JSON）
  - **localStorage**: キャッシュ用 `ngames.brickBreaker.stages.v1`
  - ※ Supabaseテーブル作成は `supabase_setup_brick_breaker_stages.sql` を実行してください
- **スコア保存**: Supabase `scores` テーブル（`game_id = "brick-breaker"`）

### ステージデータ形式（JSON）
- `cols: 14`, `rows: 10`
- `grid`: 長さ `cols*rows` の配列
  - `0` = 空
  - `1` = ふつう
  - `2` = かたい（HP3）
  - `3` = ぶんれつ
  - `4` = やわらか（壊れるが反射しない）
  - `5` = かべ（壊れない）

## ファイル構成
- `index.html`: モード選択（あそぶ/つくる）
- `stage-select.html`: ステージ選択（プレイ/編集へ）
- `play.html`: プレイ画面（フルスクリーン寄り）
- `editor.html`: ステージ編集画面（フルスクリーン寄り）
- `shared.js`: ステージ周りの共通ロジック
- `overlay.js`: 共通オーバーレイ
- `style.css`: ブロックくずし用の共通UIスタイル

## 既知の課題 / TODO
- ぶんれつが増えすぎないように最大数を制限している（調整余地あり）
- ブロックの当たり判定/反射はシンプル実装なので、角当たりの挙動は改善余地あり
