# Game: brick-breaker

## 概要
ブロックをボールで壊していくブロックくずしです。  
ステージ選択・ブロック種類（かたい/ぶんれつ）・コンティニュー・ステージエディタ（保存/共有）に対応しています。

## 操作方法
- **PC**: ゲーム画面（キャンバス）上でマウスをドラッグ/移動してバーを動かす
- **タッチ**: ゲーム画面上を指でドラッグしてバーを動かす

## ルール / 仕様
- **目的**: ボールを落とさずにブロックを全部こわす（ステージクリア）
- **スコア**:
  - ふつうブロック: +10
  - かたいブロック（HP3）: こわしたとき +35、当てたとき +2
  - ぶんれつブロック: +25（こわすとボールが最大2つ増える）
- **LIFE**: 3（ボールが全部落ちると -1）
- **コンティニュー**:
  - LIFE が残っていれば、その状態（ブロック/スコア）から「つづける」ができます
  - LIFE が0でも「コンティニュー」で復活できます（CONTINUE回数が表示されます）
- **ステージクリア**: ブロックが全部なくなるとクリア。次のステージへ進むか、選択画面へ戻れます

## 画面 / UI
- **あそぶ**: ステージ選択 / スタート / 一時停止 / 最初から、HUD（SCORE/LIFE/BALL/CONTINUE）
- **つくる**: ブロック種を選んでペイント配置、保存/読みこみ/ぜんぶ消す
- **ステージライブラリ**: ロード / 削除 / 書き出し（JSON）/ インポート / ぜんぶエクスポート

## 実装メモ（設計）
- **エントリ**: `index.html`
- **メインロジック**: `game.js`
- **主要な状態(state)**:
  - プレイ: `playingStageName`, `bricks`, `balls`, `score`, `lives`, `continueCount`
  - エディタ: `currentStage`, `currentTool`
- **データ保存（ステージ）**:
  - **Supabase**: `brick_breaker_stages` テーブル（`name` ユニーク / `data` JSON）
  - **localStorage**: キャッシュ用 `ngames.brickBreaker.stages.v1`
  - ※ Supabaseテーブル作成は `supabase_setup_brick_breaker_stages.sql` を実行してください
- **スコア保存**: Supabase `scores` テーブル（`game_id = "brick-breaker"`）

### ステージデータ形式（JSON）
- `cols: 14`, `rows: 10`
- `grid`: 長さ `cols*rows` の配列
  - `0` = 空
  - `1` = ふつう
  - `2` = かたい（HP3）
  - `3` = ぶんれつ

## ファイル構成
- `index.html`: UI（あそぶ/つくる タブ、キャンバス、ライブラリ/オーバーレイ）
- `game.js`: プレイ（物理/当たり判定/ステージ進行/コンティニュー）とエディタ（ペイント/保存/読込）

## 既知の課題 / TODO
- ぶんれつが増えすぎないように最大数を制限している（調整余地あり）
- ブロックの当たり判定/反射はシンプル実装なので、角当たりの挙動は改善余地あり
