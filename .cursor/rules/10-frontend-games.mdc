---
description: "フロント/ゲーム実装の方針（Vite + Vanilla JS、UI/UX、フォルダ運用）"
globs:
  - "src/**/*.js"
  - "src/**/*.html"
  - "src/**/*.css"
  - "public/**/*.png"
alwaysApply: false
---

# フロント/ゲーム開発ルール

## 技術選定
- 過度に複雑なフレームワーク導入は避け、既存構成（Vite + Vanilla JS）に合わせる。
- 既存ファイルのスタイル（命名、構成、DOM操作の流儀）がある場合はそれに寄せる。

## ページ/ゲーム構成
- ポータルの入口は `index.html`（リポジトリの構造に従う）。
- ゲームは `src/games/<game-name>/` 配下に `index.html` + `game.js`（または `script.js`）の形を基本とし、関連アセットは近くにまとめる。
- 既存ゲームのパターンに合わせて、相対パス・読み込み順（CSS→JS）・canvas サイズ等を崩さない。

## レスポンシブ（PC/タブレット/スマホ最適化・必須）
「スマホで見たらズレてる」を防ぐために、最初から次を守る。

### HTML（viewport）
- すべてのゲーム/ページで viewport を入れる（入ってないとスマホで拡大縮小やズレが起きやすい）。

```html
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
```

### レイアウト（CSSの基本）
- `body { margin: 0; }` / `* { box-sizing: border-box; }` は基本。
- 画面高は `100vh` ではなく `100svh` / `100dvh` を優先（スマホのアドレスバーでズレやすい）。
- 固定pxで組みすぎない：`rem` / `%` / `vw` / `clamp()` を使い、幅が狭い時に自然に詰まる設計にする。
- ボタン/タップ領域は大きめ（目安: 最低 44px 四方、余白込みで確保）。

### Canvas系ゲーム（ズレ/ぼやけ対策）
- 「描画解像度（canvas.width/height）」と「見た目サイズ（CSSのwidth/height）」を分けて扱う。
- 画面サイズ変更（リサイズ/回転）で **必ず再計算**する（`resize` イベント、必要なら `ResizeObserver`）。
- ぼやけ対策に `devicePixelRatio` を考慮して内部解像度を上げる（上げすぎは重いので上限を決める）。
- UI（スコア、ボタン等）は canvas に直描きより、可能なら DOM で重ねるとレスポンシブが楽。

### タッチ/ポインター操作（スクロール暴発を防ぐ）
- クリック専用ではなく Pointer Events を基本にする（`pointerdown/move/up`）。
- スクロール抑制は「必要な要素だけ」に限定する：
  - 例：ゲームエリアに `touch-action: none;`（ページ全体に乱用しない）
  - `preventDefault()` は必要なイベントだけ（`touchmove` で使うなら `passive: false` を忘れない）
- iOSのノッチ/ホームバーのセーフエリアを考慮し、外枠に余白を入れる：
  - 例：`padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);`

### 最低限の確認（新規ゲーム追加時のチェック）
- スマホ幅（例: 360×640 前後）で、はみ出し/重なり/読めない文字がない
- タブレット幅（例: 768×1024 前後）で、中央寄せ/余白/ボタンサイズが不自然でない
- 縦→横回転でレイアウト/当たり判定が崩れない（canvasは特に）

## UI/UX（子どもと遊ぶ前提）
- タップ/クリックの当たり判定を大きめにする（ボタン最小サイズ、余白）。
- スマホ/タブレットでの誤スクロールを抑制（必要なら `touch-action`、`preventDefault` を適切に）。
- 文字は読みやすく（コントラスト/フォントサイズ/行間）。
- アニメーションは “やりすぎない範囲で楽しく” を優先（負荷と見やすさのバランス）。

## UI文言のルール（重要：プレイヤーに“謎メッセージ”を出さない）
AIでゲームを作っていると、制作メモ/仕様変更ログのような **開発者向け文章** がそのまま画面に出てしまうことがある。これは初見プレイヤーにとって混乱要因なので、次を必ず守る。

### 絶対に画面に出さない（プレイヤー視点で意味不明な文章）
- 「県の境界はざっくり版です（今後精度アップ可能）」のような制作メモ
- 「仕様をこう変えました」「TODO」「未実装」「仮」「デバッグ用」などの内部事情
- “AIから製作者への指示” や実装方針の断り書き

### 出したい情報がある場合の正しい置き場所
- **ゲーム内チュートリアル/ヘルプ**: プレイヤー向けの短い日本語に言い換えて掲載する（例：「境界は目安です」ではなく、ゲームの遊び方に関係する説明だけにする）
- **各ゲームの `README.md`**: 精度/注意点/今後の改善点など、開発情報はここに書く
- **デバッグ画面**: `src/debug/` など開発者が見に行く場所に集約する
- **コンソールログ**: 開発時の気づきは画面ではなく `console.*` に出す（ただし出しすぎ注意）

### 実装のコツ（混入を防ぐ）
- 画面に表示する文言は “それ専用の定数/辞書” にまとめ、**開発メモと混ぜない**
- デバッグ表示や検証用ラベルは **DEV/デバッグフラグがONのときだけ** にする：
  - 例：`import.meta.env.DEV`、`?debug=1`、`localStorage` フラグ等
- 仮テキスト（例: `TODO: ...` / `NOTE:`）を UI に置かない。置く場合は必ず “DEV限定” にする

### 仕上げチェック（出荷前の目視）
- タイトル/操作説明/ボタン/メッセージに「制作メモっぽい文章」が混ざっていない
- 初見プレイヤーが読んでも “誰向けの文章？” になっていない（必要な説明だけに絞れている）

## 変更の作法
- まずは動く最小変更 → その後にリファクタや演出追加。
- 同じ処理のコピペ増殖は避け、必要なら小さな関数に切り出す（ただし抽象化しすぎない）。

## 素材（アセット）
- ローカルPC依存のパス（例: `c:\dev\...`）は前提にしない。
- 追加する場合は、リポジトリ内（`src/games/**/assets` や `public/` など）に配置し、相対パスで参照する。

### ドット絵メーカーのサンプル素材（推奨）
- **新しくゲームを作るとき**、見た目/統一感/初期クオリティが上がりそうなら **ドット絵メーカーのサンプル素材を積極的に使ってOK**。
  - **必須ではない**（ゲーム性や表現に合わない場合は無理に使わない）。
- **足りない素材がある場合**は、同じ方針で **ドット絵メーカー側のサンプル素材を追加してから**、それをゲームで使ってOK。
  - サンプルデータ: `src/pages/pixel-art-maker/samples.json`
  - 追加/更新スクリプト: `scripts/generate_pixel_art_samples.mjs`（更新後はこのスクリプトで再生成する）
- 追加するサンプルは「ゲームで使いやすい」ことを優先する（例: 16×16中心、視認性、明暗・縁取り、タグ付け）。

